<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đội hình kéo‑thả – Tộc/Hệ + Pet</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .drop-target { outline: 2px dashed #94a3b8; outline-offset: 2px; }
    .dragging { opacity: .6; }
    .scrollbar-thin::-webkit-scrollbar { height: 8px; width: 8px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #f1f5f9; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
  <div class="max-w-[1200px] mx-auto p-4 md:p-6 space-y-4">
    <header class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">Trình dựng đội hình (kéo‑thả)</h1>
        <p class="text-sm text-slate-500">Bàn cờ cố định <span class="font-semibold">2×3 = 6 ô</span>. Kéo ảnh tướng vào bàn cờ để kích hoạt
          <span class="font-semibold">tộc/hệ</span>. Có 3 ô <span class="font-semibold">Pet</span> — mỗi Pet cộng +1 vào tộc/hệ của Pet đó.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button id="btnClear" class="px-3 py-2 rounded-xl bg-slate-800 text-white text-sm hover:bg-slate-900">Làm mới</button>
        <button id="btnExport" class="px-3 py-2 rounded-xl bg-white border text-sm hover:bg-slate-100">Xuất JSON</button>
        <label class="px-3 py-2 rounded-xl bg-white border text-sm hover:bg-slate-100 cursor-pointer">Nhập JSON
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </label>
      </div>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-12 gap-1-4">
      <!-- Gallery + Bộ lọc -->
      <aside class="lg:col-span-4 space-y-3">
        <div class="p-4 rounded-2xl bg-white shadow-sm">
          <div class="flex items-center gap-2 mb-3">
            <input id="searchInput" type="text" placeholder="Tìm theo tên / tộc / hệ" class="w-full px-3 py-2 rounded-xl border" />
            <button id="btnResetFilter" class="px-3 py-2 rounded-xl bg-slate-100 text-sm">Xoá</button>
          </div>

          <!-- Tabs -->
          <div class="flex gap-2 mb-3">
            <button id="tabChamp" class="tab px-3 py-1 rounded-full border bg-slate-900 text-white text-sm">Tướng</button>
            <button id="tabPet" class="tab px-3 py-1 rounded-full border bg-white text-sm">Pet</button>
          </div>

          <div id="traitFilters" class="flex flex-wrap gap-2 mb-3"></div>
          <div id="gallery" class="grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-[48vh] overflow-auto pr-1 scrollbar-thin"></div>
        </div>
      </aside>

      <!-- Board + Pets -->
      <main class="lg:col-span-5 space-y-3">
        <div class="p-3 rounded-2xl bg-white shadow-sm">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-semibold">Bàn cờ (2×5 – không có ghế dự bị)</h2>
          </div>
          <div id="board" class="grid gap-2"></div>
        </div>

        <div class="p-3 rounded-2xl bg-white shadow-sm">
          <h2 class="font-semibold mb-2">Ô Pet (3 ô, mỗi Pet +1 trait)</h2>
          <div id="petSlots" class="grid grid-cols-3 gap-2"></div>
        </div>
      </main>

      <!-- Synergy Panel -->
      <aside class="lg:col-span-3 space-y-3">
        <div class="p-4 rounded-2xl bg-white shadow-sm">
          <h2 class="font-semibold mb-3">Tộc/Hệ kích hoạt</h2>
          <div id="synergyList" class="space-y-2"></div>
        </div>
        <div class="p-4 rounded-2xl bg-white shadow-sm">
          <h3 class="font-semibold mb-2">Mẹo nhanh</h3>
          <ul class="list-disc pl-5 text-sm space-y-1 text-slate-600">
            <li>Kéo thả để hoán đổi giữa các ô.</li>
            <li>Nhấp chuột phải vào ô để xoá.</li>
            <li>Tab <b>Tướng</b> để kéo tướng lên bàn cờ; Tab <b>Pet</b> để kéo vào ô Pet.</li>
          </ul>
        </div>
      </aside>
    </section>
  </div>

  <template id="tpl-card">
    <div class="card group select-none">
      <div draggable="true" class="dragger block rounded-xl overflow-hidden border hover:shadow transition">
        <img class="w-full aspect-square object-cover" alt="" />
      </div>
      <div class="mt-1 flex items-center justify-between gap-2">
        <div class="min-w-0">
          <p class="text-sm font-semibold truncate name"></p>
          <p class="text-[11px] text-slate-500 truncate traits"></p>
        </div>
      </div>
    </div>
  </template>

  <template id="tpl-slot">
    <div class="slot relative aspect-square rounded-xl bg-slate-100 border flex items-center justify-center">
      <img class="w-full h-full object-cover rounded-xl pointer-events-none hidden" />
      <div class="absolute inset-0 rounded-xl"></div>
    </div>
  </template>

  <script>
    // Fallback manifest nếu không tải được traits_manifest.json
    window.MANIFEST_FILES = [
      "data/warrior_data.json",
      "data/magic_data.json",
      "data/assassin_data.json",
      "data/guardian_data.json",
      "data/archer_data.json",
      "data/support_data.json",
      "data/frost_data.json",
      "data/dark_data.json"
    ];
  </script>
  <script src="script.js"></script>
</body>
</html>
